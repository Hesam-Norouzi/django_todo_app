{% extends 'tasks/base.html' %}

{% block content %}
<div class="container mt-5">
    <h2 class="mb-4">📝 My To-Do List</h2>

        <div class="mb-3">
          <a href="{% url 'add_task' %}" class="btn btn-success me-2">+ New Task</a>
      
          <!-- Filter Buttons -->
          <a href="?filter=all" class="btn btn-outline-primary {% if request.GET.filter == 'all' or not request.GET.filter %}active{% endif %}">All</a>
          <a href="?filter=completed" class="btn btn-outline-primary {% if request.GET.filter == 'completed' %}active{% endif %}">Completed</a>
          <a href="?filter=pending" class="btn btn-outline-primary {% if request.GET.filter == 'pending' %}active{% endif %}">Pending</a>
      </div>
      
    </div>
    <form method="get" class="mb-3">
      <input type="text" name="q" class="form-control d-inline w-50" placeholder="Search tasks..." value="{{ request.GET.q }}">
      <button type="submit" class="btn btn-primary ms-2">Search</button>
  </form>
  
    {% if tasks %}
        {% for task in tasks %}
            <div class="card mb-3 shadow-sm">
              <div class="card-body d-flex justify-content-between align-items-center {% if task.completed %}bg-light{% endif %}" style="{% if task.completed %}opacity: 0.6;{% endif %}">
                    <div>
                        <h5 class="card-title mb-0">{{ task.title }}</h5>
                    </div>
                    <div>
                        <small class="text-muted me-3">{{ task.created|date:"Y-m-d H:i" }}</small>
                        <a href="{% url 'toggle_complete' task.id %}" class="btn btn-sm {% if task.complete %}btn-warning{% else %}btn-success{% endif %}">
                            {% if task.complete %}Mark as Incomplete{% else %}Mark as Done{% endif %}
                        </a>
                        <a href="{% url 'edit_task' task.id %}" class="btn btn-sm btn-primary ms-1">Edit</a>
                        <a href="{% url 'delete_task' task.id %}" class="btn btn-sm btn-danger ms-1">Delete</a>
                    </div>
                </div>
            </div>
        {% endfor %}
    {% else %}
        <p>No tasks yet. <a href="{% url 'add_task' %}">Create one</a>!</p>
    {% endif %}
</div>
{% endblock %}
